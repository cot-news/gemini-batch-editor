<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Pro 智能批量抠图工作站</title>
    <!-- 引入样式与脚本库 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3B82F6', secondary: '#10B981', accent: '#6366F1', dark: '#1E293B' },
                    animation: { 'fade-in': 'fadeIn 0.6s ease-in-out', 'slide-up': 'slideUp 0.8s ease-out' }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .glass { backdrop-filter: blur(12px); background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(255, 255, 255, 0.3); }
            .card-hover { transition: all 0.3s ease; }
            .card-hover:hover { transform: translateY(-5px); box-shadow: 0 15px 30px -10px rgba(0,0,0,0.1); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900 overflow-x-hidden">

    <!-- 1. 导航栏 -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="bg-primary rounded-xl p-2 shadow-lg shadow-blue-200 text-white">
                        <i class="fa fa-magic text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold">Gemini <span class="text-primary">Batch</span></h1>
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold">Smart Image Editor</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#workflow" class="text-sm text-gray-500 hover:text-primary transition-colors">技术架构</a>
                    <button onclick="document.getElementById('editor').scrollIntoView({behavior:'smooth'})" class="bg-primary text-white px-5 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-200 hover:opacity-90 transition-all">
                        开始使用
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 2. Hero 英雄区域 -->
    <section class="relative py-20 overflow-hidden">
        <div class="absolute inset-0 gradient-bg opacity-5"></div>
        <div class="max-w-7xl mx-auto px-4 text-center relative z-10 animate-fade-in">
            <h2 class="text-5xl md:text-7xl font-black text-dark mb-6 tracking-tight">
                让 AI 成为你的 <span class="text-primary italic">后期专家</span>
            </h2>
            <p class="text-xl text-gray-500 max-w-2xl mx-auto mb-10 leading-relaxed">
                结合 Gemini Pro 的图像分析大脑与高性能抠图引擎，<br>为您的电商产品图片实现一键批量背景移除与智能阴影。
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-full shadow-sm border border-gray-100 text-sm text-gray-500">
                    <i class="fa fa-check-circle text-success"></i> <span>基于 Gemini 1.5 Flash</span>
                </div>
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-full shadow-sm border border-gray-100 text-sm text-gray-500">
                    <i class="fa fa-check-circle text-success"></i> <span>ClawCloud 反代支持</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 3. 核心编辑器区域 (智能工作台) -->
    <section id="editor" class="max-w-7xl mx-auto px-4 py-12 scroll-mt-20">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- 控制台 (左侧) -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-white rounded-[2rem] p-8 shadow-xl shadow-gray-200/50 border border-gray-100">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fa fa-cog mr-3 text-primary"></i> 任务配置
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[11px] font-black text-gray-400 uppercase tracking-wider mb-1 block">Gemini 反代地址</label>
                            <input type="text" id="geminiProxy" value="https://yqyfmcrtvcih.us-west-1.clawcloudrun.com/v1beta" class="w-full px-4 py-3 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-primary outline-none transition-all text-sm">
                        </div>

                        <div>
                            <label class="text-[11px] font-black text-gray-400 uppercase tracking-wider mb-1 block">Hugging Face 后端</label>
                            <input type="text" id="hfBackend" value="https://naidd-my-ai-remover.hf.space" class="w-full px-4 py-3 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-primary outline-none transition-all text-sm">
                        </div>

                        <div>
                            <label class="text-[11px] font-black text-gray-400 uppercase tracking-wider mb-1 block">Gemini API Key</label>
                            <input type="password" id="apiKey" placeholder="在此输入 API Key" class="w-full px-4 py-3 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-primary outline-none transition-all text-sm shadow-inner">
                        </div>

                        <div id="dropZone" class="border-2 border-dashed border-blue-100 rounded-3xl p-8 text-center bg-blue-50/30 hover:bg-blue-50 hover:border-primary transition-all cursor-pointer group" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                            <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg group-hover:scale-110 transition-all">
                                <i class="fa fa-plus text-primary text-xl"></i>
                            </div>
                            <p class="text-sm font-bold text-gray-700">添加图片</p>
                            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-tighter">支持多选处理</p>
                        </div>

                        <button onclick="startBatchProcess()" id="startBtn" class="w-full mt-6 bg-primary hover:bg-blue-600 text-white py-5 rounded-[1.5rem] font-bold shadow-xl shadow-blue-200 transition-all flex items-center justify-center space-x-3">
                            <i class="fa fa-rocket"></i>
                            <span>开始一键智能抠图</span>
                        </button>
                    </div>
                </div>
                
                <!-- 技术优势展示 -->
                <div class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-[2rem] p-6 text-white shadow-xl shadow-blue-200">
                    <h4 class="font-bold flex items-center mb-3">
                        <i class="fa fa-lightbulb-o mr-2"></i> 技术优势
                    </h4>
                    <p class="text-xs text-blue-100 leading-relaxed opacity-90">
                        采用最新的 Gemini 1.5 Flash 视觉模型，自动分析光源方向与阴影半径，并由后端专用抠图算法执行高精度分割。
                    </p>
                </div>
            </div>

            <!-- 结果区 (右侧) -->
            <div class="lg:col-span-8">
                <div class="bg-white rounded-[2rem] p-8 shadow-xl shadow-gray-200/50 border border-gray-100 min-h-[600px] relative">
                    <!-- 进度显示 -->
                    <div id="progressArea" class="hidden mb-10 animate-fade-in">
                        <div class="flex justify-between items-end mb-3">
                            <div>
                                <h4 id="progressText" class="text-primary font-black text-lg">AI 正在思考...</h4>
                                <p class="text-[10px] text-gray-400 uppercase tracking-widest">Processing Queue</p>
                            </div>
                            <span id="percentText" class="text-3xl font-black text-gray-200">0%</span>
                        </div>
                        <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                            <div id="progressBar" class="bg-primary h-full transition-all duration-700 ease-out" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- 动态网格 -->
                    <div id="resultGrid" class="grid grid-cols-2 md:grid-cols-3 gap-6">
                        <div class="col-span-full py-40 text-center">
                            <i class="fa fa-images text-7xl text-gray-100 mb-6"></i>
                            <p class="text-gray-300 font-medium">还没有待处理的任务</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. 痛点分析区域 (参考网页风格) -->
    <section class="bg-white py-24">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-16">
                <h3 class="text-3xl font-black text-dark mb-4">为什么选择我们？</h3>
                <p class="text-gray-500">解决传统电商抠图的繁琐与僵硬</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-red-50 p-8 rounded-[2rem] border border-red-100 card-hover">
                    <div class="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mb-6"><i class="fa fa-clock-o text-xl"></i></div>
                    <h4 class="text-xl font-bold mb-3">告别手动 PS</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">传统人工抠图每张需花费 3-5 分钟，本工具仅需 5-10 秒即可完成批量化任务。</p>
                </div>
                <div class="bg-orange-50 p-8 rounded-[2rem] border border-orange-100 card-hover">
                    <div class="w-12 h-12 bg-orange-100 text-orange-500 rounded-full flex items-center justify-center mb-6"><i class="fa fa-cubes text-xl"></i></div>
                    <h4 class="text-xl font-bold mb-3">智能阴影模拟</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">不仅仅是去背景。Gemini 智能分析产品形态，模拟真实自然的光影落地效果。</p>
                </div>
                <div class="bg-purple-50 p-8 rounded-[2rem] border border-purple-100 card-hover">
                    <div class="w-12 h-12 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-6"><i class="fa fa-money text-xl"></i></div>
                    <h4 class="text-xl font-bold mb-3">零成本部署</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">利用 Hugging Face 免费算力与 Gemini 免费 API，实现真正的零成本商业级工具。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. 性能展示图表 -->
    <section class="bg-gray-50 py-24">
        <div class="max-w-5xl mx-auto px-4">
            <div class="bg-white p-10 rounded-[3rem] shadow-xl border border-gray-100">
                <h3 class="text-2xl font-black text-center mb-10">处理效率对比</h3>
                <div class="h-80">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- 6. 页脚 -->
    <footer class="bg-dark text-gray-400 py-16">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-12">
            <div class="col-span-2">
                <div class="flex items-center space-x-3 mb-6">
                    <div class="bg-primary rounded-xl p-2 text-white">
                        <i class="fa fa-magic"></i>
                    </div>
                    <span class="text-white font-bold text-xl">Gemini Batch Editor</span>
                </div>
                <p class="text-sm leading-relaxed max-w-sm">基于 Google Gemini Pro 的专业批量图像处理解决方案。为电商企业提供最高效的 AI 视觉处理能力。</p>
            </div>
            <div>
                <h5 class="text-white font-bold mb-4">链接</h5>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="hover:text-white transition-colors">GitHub 源码</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">API 文档</a></li>
                </ul>
            </div>
            <div>
                <h5 class="text-white font-bold mb-4">联系</h5>
                <p class="text-sm italic">AI Powered Backend on Hugging Face</p>
            </div>
        </div>
        <div class="max-w-7xl mx-auto px-4 border-t border-gray-800 mt-12 pt-8 text-center text-xs tracking-widest">
            &copy; 2026 GEMINI BATCH EDITOR. ALL RIGHTS RESERVED.
        </div>
    </footer>

    <!-- 核心逻辑脚本 -->
    <script>
        let queue = [];
        let isProcessing = false;

        // 文件选择监听
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            queue = [...queue, ...files.map(file => ({
                file: file,
                status: 'ready',
                resultUrl: null,
                log: '等待启动'
            }))];
            renderGrid();
        });

        // 渲染列表
        function renderGrid() {
            const grid = document.getElementById('resultGrid');
            if (queue.length === 0) return;
            grid.innerHTML = queue.map((item, index) => `
                <div class="relative bg-white rounded-3xl border border-gray-100 overflow-hidden group shadow-sm hover:shadow-xl transition-all duration-500 card-hover">
                    <img src="${item.resultUrl || URL.createObjectURL(item.file)}" class="w-full aspect-square object-cover ${item.status === 'processing' ? 'scale-110 blur-sm opacity-50' : 'scale-100' } transition-all duration-700">
                    
                    ${item.status === 'processing' ? `
                        <div class="absolute inset-0 flex flex-col items-center justify-center p-4">
                            <div class="bg-white/90 backdrop-blur p-4 rounded-2xl shadow-xl flex flex-col items-center">
                                <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
                                <span class="text-[10px] font-black text-gray-500 uppercase tracking-tighter">${item.log}</span>
                            </div>
                        </div>
                    ` : ''}

                    ${item.status === 'success' ? `
                        <div class="absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center">
                            <a href="${item.resultUrl}" download="smart_${item.file.name}" class="bg-white w-12 h-12 rounded-full flex items-center justify-center text-primary shadow-2xl hover:scale-125 transition-transform">
                                <i class="fa fa-download"></i>
                            </a>
                        </div>
                        <div class="absolute top-4 right-4 bg-success text-white w-7 h-7 rounded-full flex items-center justify-center shadow-lg animate-bounce">
                            <i class="fa fa-check text-xs"></i>
                        </div>
                    ` : ''}

                    ${item.status === 'error' ? `
                        <div class="absolute inset-0 bg-red-50/90 flex items-center justify-center p-4 text-center">
                            <p class="text-red-500 text-[10px] font-bold uppercase">处理失败</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // 批量处理主逻辑
        async function startBatchProcess() {
            if (isProcessing || queue.length === 0) return;
            
            const apiKey = document.getElementById('apiKey').value;
            const geminiUrl = document.getElementById('geminiProxy').value;
            const hfUrl = document.getElementById('hfBackend').value;

            if (!apiKey) return alert("请先输入 Gemini API Key 以激活大脑分析引擎！");

            isProcessing = true;
            document.getElementById('progressArea').classList.remove('hidden');

            for (let i = 0; i < queue.length; i++) {
                if (queue[i].status === 'success') continue;

                queue[i].status = 'processing';
                queue[i].log = '大脑分析中...';
                renderGrid();
                updateProgress(i, queue.length);

                try {
                    // 1. Gemini 分析
                    const base64 = await toBase64(queue[i].file);
                    const geminiRes = await fetch(`${geminiUrl}/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: "分析此图，给出抠图加阴影参数：offset_x, offset_y, blur(5-15), opacity(0.3-0.6)。只返回 JSON 示例: {\"offset_x\": 10, \"offset_y\": 10, \"blur\": 8, \"opacity\": 0.4}" },
                                    { inline_data: { mime_type: queue[i].file.type, data: base64.split(',')[1] } }
                                ]
                            }]
                        })
                    });

                    if (!geminiRes.ok) throw new Error("Gemini 无法连接");
                    const geminiData = await geminiRes.json();
                    const rawText = geminiData.candidates[0].content.parts[0].text;
                    const shadowParams = rawText.match(/\{.*\}/s)[0]; 

                    // 2. HF 执行
                    queue[i].log = '算法执行中...';
                    renderGrid();

                    const fd = new FormData();
                    fd.append('file', queue[i].file);
                    fd.append('shadow_params', shadowParams);

                    const hfRes = await fetch(`${hfUrl}/process_smart`, { method: 'POST', body: fd });
                    if (!hfRes.ok) throw new Error("后端连接失败");
                    
                    const blob = await hfRes.blob();
                    queue[i].resultUrl = URL.createObjectURL(blob);
                    queue[i].status = 'success';

                } catch (error) {
                    console.error(error);
                    queue[i].status = 'error';
                }

                renderGrid();
                updateProgress(i + 1, queue.length);
            }
            isProcessing = false;
            document.getElementById('progressText').innerText = "任务处理完毕！";
        }

        // 工具函数
        function toBase64(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
            });
        }

        function updateProgress(cur, total) {
            const percent = Math.round((cur / total) * 100);
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('percentText').innerText = percent + '%';
        }

        // 初始化图表
        const ctx = document.getElementById('performanceChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['传统手动', '普通 AI', 'Gemini Smart Editor'],
                datasets: [{
                    label: '处理 10 张图平均耗时 (秒)',
                    data: [1200, 60, 15],
                    backgroundColor: ['#f87171', '#fbbf24', '#3b82f6'],
                    borderRadius: 10
                }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });

        // 滚动动画观察器
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('animate-slide-up');
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.card-hover').forEach(card => observer.observe(card));
    </script>
</body>
</html>
